"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.makeExecute = void 0;
const ea_bootstrap_1 = require("@chainlink/ea-bootstrap");
const ea_reference_data_reader_1 = require("@chainlink/ea-reference-data-reader");
const config_1 = require("./config");
const customParams = {
    referenceContract: ['referenceContract', 'contract'],
    multiply: true,
    source: true,
    check: false,
    check_threshold: false,
    onchain_threshold: false,
    network: false,
};
const execute = async (input, _, config) => {
    const paramOptions = config_1.makeOptions(config);
    const validator = new ea_bootstrap_1.Validator(input, customParams, paramOptions);
    if (validator.error)
        throw validator.error;
    const jobRunID = validator.validated.jobRunID;
    const source = validator.validated.data.source.toUpperCase();
    const check = validator.validated.data.check?.toUpperCase();
    const check_threshold = validator.validated.data.check_threshold || config_1.DEFAULT_CHECK_THRESHOLD;
    const onchain_threshold = validator.validated.data.onchain_threshold || config_1.DEFAULT_ONCHAIN_THRESHOLD;
    const { referenceContract, multiply } = validator.validated.data;
    const network = validator.validated.data.network || config_1.DEFAULT_NETWORK;
    const onchainValue = await ea_reference_data_reader_1.getLatestAnswer(network, referenceContract, multiply, input.meta);
    const sourceMedian = await getExecuteMedian(config.sources, source, input);
    if (onchain_threshold > 0) {
        if (difference(sourceMedian, onchainValue) > onchain_threshold) {
            return success(jobRunID, onchainValue);
        }
    }
    if (check_threshold > 0) {
        if (!check) {
            throw Error('No check adapters provided');
        }
        const checkMedian = await getExecuteMedian(config.checks, check, input);
        if (difference(sourceMedian, checkMedian) > check_threshold) {
            return success(jobRunID, onchainValue);
        }
    }
    return success(jobRunID, sourceMedian);
};
const getExecuteMedian = async (options, adapters, request) => {
    const responses = await Promise.allSettled(adapters.split(',').map(async (a) => await ea_bootstrap_1.Requester.request({
        ...options[a],
        data: request,
    })));
    const values = responses
        .filter((result) => result.status === 'fulfilled' && 'value' in result)
        .map((result) => result.value.data.result);
    if (values.length === 0)
        throw Error('Unable to fetch value from any of the data providers');
    return median(values);
};
const median = (values) => {
    if (values.length === 0)
        return 0;
    values.sort((a, b) => a - b);
    const half = Math.floor(values.length / 2);
    if (values.length % 2)
        return values[half];
    return (values[half - 1] + values[half]) / 2.0;
};
const difference = (a, b) => {
    return (Math.abs(a - b) / ((a + b) / 2)) * 100;
};
const success = (jobRunID, result) => {
    const response = { data: { result }, status: 200 };
    return ea_bootstrap_1.Requester.success(jobRunID, response);
};
const makeExecute = (config) => {
    return async (request, context) => execute(request, context, config || config_1.makeConfig());
};
exports.makeExecute = makeExecute;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRhcHRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9hZGFwdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQU9BLDBEQUE4RDtBQUM5RCxrRkFBcUU7QUFDckUscUNBT2lCO0FBWWpCLE1BQU0sWUFBWSxHQUFHO0lBQ25CLGlCQUFpQixFQUFFLENBQUMsbUJBQW1CLEVBQUUsVUFBVSxDQUFDO0lBQ3BELFFBQVEsRUFBRSxJQUFJO0lBQ2QsTUFBTSxFQUFFLElBQUk7SUFDWixLQUFLLEVBQUUsS0FBSztJQUNaLGVBQWUsRUFBRSxLQUFLO0lBQ3RCLGlCQUFpQixFQUFFLEtBQUs7SUFDeEIsT0FBTyxFQUFFLEtBQUs7Q0FDZixDQUFBO0FBRUQsTUFBTSxPQUFPLEdBQThCLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxFQUFFO0lBQ3BFLE1BQU0sWUFBWSxHQUFHLG9CQUFXLENBQUMsTUFBTSxDQUFDLENBQUE7SUFDeEMsTUFBTSxTQUFTLEdBQUcsSUFBSSx3QkFBUyxDQUFDLEtBQUssRUFBRSxZQUFZLEVBQUUsWUFBWSxDQUFDLENBQUE7SUFDbEUsSUFBSSxTQUFTLENBQUMsS0FBSztRQUFFLE1BQU0sU0FBUyxDQUFDLEtBQUssQ0FBQTtJQUUxQyxNQUFNLFFBQVEsR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQTtJQUM3QyxNQUFNLE1BQU0sR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLENBQUE7SUFDNUQsTUFBTSxLQUFLLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLFdBQVcsRUFBRSxDQUFBO0lBQzNELE1BQU0sZUFBZSxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLGVBQWUsSUFBSSxnQ0FBdUIsQ0FBQTtJQUMzRixNQUFNLGlCQUFpQixHQUFHLFNBQVMsQ0FBQyxTQUFT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LENBQUMsSUFBSSxDQUFDLENBQUE7SUFDMUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFBO0FBQ2hELENBQUMsQ0FBQTtBQUVELE1BQU0sVUFBVSxHQUFHLENBQUMsQ0FBUyxFQUFFLENBQVMsRUFBVSxFQUFFO0lBQ2xELE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFBO0FBQ2hELENBQUMsQ0FBQTtBQUVELE1BQU0sT0FBTyxHQUFHLENBQUMsUUFBZ0IsRUFBRSxNQUFjLEVBQW1CLEVBQUU7SUFDcEUsTUFBTSxRQUFRLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLENBQUE7SUFDbEQsT0FBTyx3QkFBUyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUE7QUFDOUMsQ0FBQyxDQUFBO0FBRU0sTUFBTSxXQUFXLEdBQTJCLENBQUMsTUFBTSxFQUFFLEVBQUU7SUFDNUQsT0FBTyxLQUFLLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxJQUFJLG1CQUFVLEVBQUUsQ0FBQyxDQUFBO0FBQ3RGLENBQUMsQ0FBQTtBQUZZLFFBQUEsV0FBVyxlQUV2QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFkYXB0ZXJSZXF1ZXN0LFxuICBBZGFwdGVyUmVzcG9uc2UsXG4gIEV4ZWN1dGVGYWN0b3J5LFxuICBFeGVjdXRlV2l0aENvbmZpZyxcbiAgUmVxdWVzdENvbmZpZyxcbn0gZnJvbSAnQGNoYWlubGluay90eXBlcydcbmltcG9ydCB7IFJlcXVlc3RlciwgVmFsaWRhdG9yIH0gZnJvbSAnQGNoYWlubGluay9lYS1ib290c3RyYXAnXG5pbXBvcnQgeyBnZXRMYXRlc3RBbnN3ZXIgfSBmcm9tICdAY2hhaW5saW5rL2VhLXJlZmVyZW5jZS1kYXRhLXJlYWRlcidcbmltcG9ydCB7XG4gIG1ha2VDb25maWcsXG4gIERFRkFVTFRfQ0hFQ0tfVEhSRVNIT0xELFxuICBERUZBVUxUX09OQ0hBSU5fVEhSRVNIT0xELFxuICBERUZBVUxUX05FVFdPUkssXG4gIG1ha2VPcHRpb25zLFxuICBDb25maWcsXG59IGZyb20gJy4vY29uZmlnJ1xuaW1wb3J0IHsgQXhpb3NSZXNwb25zZSB9IGZyb20gJ2F4aW9zJ1xuXG5leHBvcnQgdHlwZSBTb3VyY2VSZXF1ZXN0T3B0aW9ucyA9IHsgW3NvdXJjZTogc3RyaW5nXTogUmVxdWVzdENvbmZpZyB9XG5leHBvcnQgdHlwZSBDaGVja1JlcXVlc3RPcHRpb25zID0geyBbY2hlY2s6IHN0cmluZ106IFJlcXVlc3RDb25maWcgfVxuXG5leHBvcnQgdHlwZSBBZGFwdGVyT3B0aW9ucyA9IHtcbiAgc291cmNlczogU291cmNlUmVxdWVzdE9wdGlvbnNcbiAgY2hlY2tzOiBDaGVja1JlcXVlc3RPcHRpb25zXG4gIGFwaTogYW55XG59XG5cbmNvbnN0IGN1c3RvbVBhcmFtcyA9IHtcbiAgcmVmZXJlbmNlQ29udHJhY3Q6IFsncmVmZXJlbmNlQ29udHJhY3QnLCAnY29udHJhY3QnXSxcbiAgbXVsdGlwbHk6IHRydWUsXG4gIHNvdXJjZTogdHJ1ZSxcbiAgY2hlY2s6IGZhbHNlLFxuICBjaGVja190aHJlc2hvbGQ6IGZhbHNlLFxuICBvbmNoYWluX3RocmVzaG9sZDogZmFsc2UsXG4gIG5ldHdvcms6IGZhbHNlLFxufVxuXG5jb25zdCBleGVjdXRlOiBFeGVjdXRlV2l0aENvbmZpZzxDb25maWc+ID0gYXN5bmMgKGlucHV0LCBfLCBjb25maWcpID0+IHtcbiAgY29uc3QgcGFyYW1PcHRpb25zID0gbWFrZU9wdGlvbnMoY29uZmlnKVxuICBjb25zdCB2YWxpZGF0b3IgPSBuZXcgVmFsaWRhdG9yKGlucHV0LCBjdXN0b21QYXJhbXMsIHBhcmFtT3B0aW9ucylcbiAgaWYgKHZhbGlkYXRvci5lcnJvcikgdGhyb3cgdmFsaWRhdG9yLmVycm9yXG5cbiAgY29uc3Qgam9iUnVuSUQgPSB2YWxpZGF0b3IudmFsaWRhdGVkLmpvYlJ1bklEXG4gIGNvbnN0IHNvdXJjZSA9IHZhbGlkYXRvci52YWxpZGF0ZWQuZGF0YS5zb3VyY2UudG9VcHBlckNhc2UoKVxuICBjb25zdCBjaGVjayA9IHZhbGlkYXRvci52YWxpZGF0ZWQuZGF0YS5jaGVjaz8udG9VcHBlckNhc2UoKVxuICBjb25zdCBjaGVja190aHJlc2hvbGQgPSB2YWxpZGF0b3IudmFsaWRhdGVkLmRhdGEuY2hlY2tfdGhyZXNob2xkIHx8IERFRkFVTFRfQ0hFQ0tfVEhSRVNIT0xEXG4gIGNvbnN0IG9uY2hhaW5fdGhyZXNob2xkID0gdmFsaWRhdG9yLnZhbGlkYXRlZC5kYXRhLm9uY2hhaW5fdGhyZXNob2xkIHx8IERFRkFVTFRfT05DSEFJTl9USFJFU0hPTERcbiAgY29uc3QgeyByZWZlcmVuY2VDb250cmFjdCwgbXVsdGlwbHkgfSA9IHZhbGlkYXRvci52YWxpZGF0ZWQuZGF0YVxuICBjb25zdCBuZXR3b3JrID0gdmFsaWRhdG9yLnZhbGlkYXRlZC5kYXRhLm5ldHdvcmsgfHwgREVGQVVMVF9ORVRXT1JLXG5cbiAgY29uc3Qgb25jaGFpblZhbHVlID0gYXdhaXQgZ2V0TGF0ZXN0QW5zd2VyKG5ldHdvcmssIHJlZmVyZW5jZUNvbnRyYWN0LCBtdWx0aXBseSwgaW5wdXQubWV0YSlcblxuICBjb25zdCBzb3VyY2VNZWRpYW4gPSBhd2FpdCBnZXRFeGVjdXRlTWVkaWFuKGNvbmZpZy5zb3VyY2VzLCBzb3VyY2UsIGlucHV0KVxuXG4gIGlmIChvbmNoYWluX3RocmVzaG9sZCA+IDApIHtcbiAgICBpZiAoZGlmZmVyZW5jZShzb3VyY2VNZWRpYW4sIG9uY2hhaW5WYWx1ZSkgPiBvbmNoYWluX3RocmVzaG9sZCkge1xuICAgICAgcmV0dXJuIHN1Y2Nlc3Moam9iUnVuSUQsIG9uY2hhaW5WYWx1ZSlcbiAgICB9XG4gIH1cblxuICBpZiAoY2hlY2tfdGhyZXNob2xkID4gMCkge1xuICAgIGlmICghY2hlY2spIHtcbiAgICAgIHRocm93IEVycm9yKCdObyBjaGVjayBhZGFwdGVycyBwcm92aWRlZCcpXG4gICAgfVxuXG4gICAgY29uc3QgY2hlY2tNZWRpYW4gPSBhd2FpdCBnZXRFeGVjdXRlTWVkaWFuKGNvbmZpZy5jaGVja3MsIGNoZWNrLCBpbnB1dClcbiAgICBpZiAoZGlmZmVyZW5jZShzb3VyY2VNZWRpYW4sIGNoZWNrTWVkaWFuKSA+IGNoZWNrX3RocmVzaG9sZCkge1xuICAgICAgcmV0dXJuIHN1Y2Nlc3Moam9iUnVuSUQsIG9uY2hhaW5WYWx1ZSlcbiAgICB9XG4gIH1cblxuICByZXR1cm4gc3VjY2Vzcyhqb2JSdW5JRCwgc291cmNlTWVkaWFuKVxufVxuXG5jb25zdCBnZXRFeGVjdXRlTWVkaWFuID0gYXN5bmMgKFxuICBvcHRpb25zOiBTb3VyY2VSZXF1ZXN0T3B0aW9ucyB8IENoZWNrUmVxdWVzdE9wdGlvbnMsXG4gIGFkYXB0ZXJzOiBzdHJpbmcsXG4gIHJlcXVlc3Q6IEFkYXB0ZXJSZXF1ZXN0LFxuKTogUHJvbWlzZTxudW1iZXI+ID0+IHtcbiAgY29uc3QgcmVzcG9uc2VzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKFxuICAgIGFkYXB0ZXJzLnNwbGl0KCcsJykubWFwKFxuICAgICAgYXN5bmMgKGEpID0+XG4gICAgICAgIGF3YWl0IFJlcXVlc3Rlci5yZXF1ZXN0KHtcbiAgICAgICAgICAuLi5vcHRpb25zW2FdLFxuICAgICAgICAgIGRhdGE6IHJlcXVlc3QsXG4gICAgICAgIH0pLFxuICAgICksXG4gIClcbiAgY29uc3QgdmFsdWVzID0gcmVzcG9uc2VzXG4gICAgLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQuc3RhdHVzID09PSAnZnVsZmlsbGVkJyAmJiAndmFsdWUnIGluIHJlc3VsdClcbiAgICAubWFwKFxuICAgICAgKHJlc3VsdCkgPT5cbiAgICAgICAgKHJlc3VsdCBhcyBQcm9taXNlRnVsZmlsbGVkUmVzdWx0PEF4aW9zUmVzcG9uc2U8UmVjb3JkPHN0cmluZywgYW55Pj4+KS52YWx1ZS5kYXRhLnJlc3VsdCxcbiAgICApXG4gIGlmICh2YWx1ZXMubGVuZ3RoID09PSAwKSB0aHJvdyBFcnJvcignVW5hYmxlIHRvIGZldGNoIHZhbHVlIGZyb20gYW55IG9mIHRoZSBkYXRhIHByb3ZpZGVycycpXG4gIHJldHVybiBtZWRpYW4odmFsdWVzKVxufVxuXG5jb25zdCBtZWRpYW4gPSAodmFsdWVzOiBudW1iZXJbXSk6IG51bWJlciA9PiB7XG4gIGlmICh2YWx1ZXMubGVuZ3RoID09PSAwKSByZXR1cm4gMFxuICB2YWx1ZXMuc29ydCgoYSwgYikgPT4gYSAtIGIpXG4gIGNvbnN0IGhhbGYgPSBNYXRoLmZsb29yKHZhbHVlcy5sZW5ndGggLyAyKVxuICBpZiAodmFsdWVzLmxlbmd0aCAlIDIpIHJldHVybiB2YWx1ZXNbaGFsZl1cbiAgcmV0dXJuICh2YWx1ZXNbaGFsZiAtIDFdICsgdmFsdWVzW2hhbGZdKSAvIDIuMFxufVxuXG5jb25zdCBkaWZmZXJlbmNlID0gKGE6IG51bWJlciwgYjogbnVtYmVyKTogbnVtYmVyID0+IHtcbiAgcmV0dXJuIChNYXRoLmFicyhhIC0gYikgLyAoKGEgKyBiKSAvIDIpKSAqIDEwMFxufVxuXG5jb25zdCBzdWNjZXNzID0gKGpvYlJ1bklEOiBzdHJpbmcsIHJlc3VsdDogbnVtYmVyKTogQWRhcHRlclJlc3BvbnNlID0+IHtcbiAgY29uc3QgcmVzcG9uc2UgPSB7IGRhdGE6IHsgcmVzdWx0IH0sIHN0YXR1czogMjAwIH1cbiAgcmV0dXJuIFJlcXVlc3Rlci5zdWNjZXNzKGpvYlJ1bklELCByZXNwb25zZSlcbn1cblxuZXhwb3J0IGNvbnN0IG1ha2VFeGVjdXRlOiBFeGVjdXRlRmFjdG9yeTxDb25maWc+ID0gKGNvbmZpZykgPT4ge1xuICByZXR1cm4gYXN5bmMgKHJlcXVlc3QsIGNvbnRleHQpID0+IGV4ZWN1dGUocmVxdWVzdCwgY29udGV4dCwgY29uZmlnIHx8IG1ha2VDb25maWcoKSlcbn1cbiJdfQ==