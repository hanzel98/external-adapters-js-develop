"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.makeExecute = exports.execute = void 0;
const ea_bootstrap_1 = require("@chainlink/ea-bootstrap");
const config_1 = require("./config");
const customError = (data) => data.result === 'error';
const customParams = {
    base: ['base', 'from', 'coin'],
    quote: ['quote', 'to', 'market'],
    includes: false,
    interval: false,
    sort: false,
    millisecondsAgo: false,
};
const symbolUrl = (from, to) => to.toLowerCase() === 'eth'
    ? directUrl(from, to)
    : `/spot_exchange_rate/${from.toLowerCase()}/${to.toLowerCase()}`;
const directUrl = (from, to) => `/spot_direct_exchange_rate/${from.toLowerCase()}/${to.toLowerCase()}`;
const execute = async (request, _, config) => {
    const validator = new ea_bootstrap_1.Validator(request, customParams);
    if (validator.error)
        throw validator.error;
    ea_bootstrap_1.Requester.logConfig(config);
    const jobRunID = validator.validated.id;
    // provide a reasonable interval to fetch only recent results
    function calculateStartTime(millisecondsAgo) {
        const date = new Date();
        date.setTime(date.getTime() - millisecondsAgo);
        return date;
    }
    const { url, inverse } = getOptions(validator);
    const interval = validator.validated.data.interval || config_1.DEFAULT_INTERVAL;
    const start_time = calculateStartTime(validator.validated.data.millisecondsAgo || config_1.DEFAULT_MILLISECONDS);
    const sort = validator.validated.data.sort || config_1.DEFAULT_SORT;
    const params = { interval, sort, start_time };
    const requestConfig = {
        ...config.api,
        url,
        params,
        timeout: 10000,
    };
    const response = await ea_bootstrap_1.Requester.request(requestConfig, customError);
    response.data.result = ea_bootstrap_1.Requester.validateResultNumber(
    // sometimes, the most recent(fraction of a second) data contain null price
    response.data.data.filter((x) => x.price !== null), [0, 'price'], { inverse });
    return ea_bootstrap_1.Requester.success(jobRunID, response, config.verbose);
};
exports.execute = execute;
const makeExecute = (config) => {
    return async (request, context) => exports.execute(request, context, config || config_1.makeConfig());
};
exports.makeExecute = makeExecute;
const getOptions = (validator) => {
    const base = validator.overrideSymbol(config_1.NAME);
    const quote = validator.validated.data.quote;
    const includes = validator.validated.includes || [];
    const includeOptions = getIncludesOptions(validator, base, quote, includes);
    return (includeOptions ?? {
        url: symbolUrl(base, quote),
    });
};
const getIncludesOptions = (validator, from, to, includes) => {
    const include = getIncludes(validator, from, to, includes);
    if (!include)
        return undefined;
    return {
        url: directUrl(include.from, include.to),
        inverse: include.inverse,
    };
};
const getIncludes = (validator, from, to, includes) => {
    if (includes.length === 0)
        return undefined;
    const presetIncludes = validator.overrideIncludes(config_1.NAME, from, to);
    if (presetIncludes && typeof includes[0] === 'string')
        return presetIncludes;
    else if (typeof includes[0] === 'string') {
        return {
            from,
            to: includes[0],
            inverse: false,
        };
    }
    return presetIncludes;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRhcHRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9hZGFwdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDBEQUE4RDtBQUU5RCxxQ0FNaUI7QUFFakIsTUFBTSxXQUFXLEdBQUcsQ0FBQyxJQUFTLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLEtBQUssT0FBTyxDQUFBO0FBRTFELE1BQU0sWUFBWSxHQUFHO0lBQ25CLElBQUksRUFBRSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDO0lBQzlCLEtBQUssRUFBRSxDQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsUUFBUSxDQUFDO0lBQ2hDLFFBQVEsRUFBRSxLQUFLO0lBQ2YsUUFBUSxFQUFFLEtBQUs7SUFDZixJQUFJLEVBQUUsS0FBSztJQUNYLGVBQWUsRUFBRSxLQUFLO0NBQ3ZCLENBQUE7QUFFRCxNQUFNLFNBQVMsR0FBRyxDQUFDLElBQVksRUFBRSxFQUFVLEVBQUUsRUFBRSxDQUM3QyxFQUFFLENBQUMsV0FBVyxFQUFFLEtBQUssS0FBSztJQUN4QixDQUFDLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUM7SUFDckIsQ0FBQyxDQUFDLHVCQUF1QixJQUFJLENBQUMsV0FBVyxFQUFFLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxFQUFFLENBQUE7QUFFckUsTUFBTSxTQUFTLEdBQUcsQ0FBQyxJQUFZLEVBQUUsRUFBVSxFQUFFLEVBQUUsQ0FDN0MsOEJBQThCLElBQUksQ0FBQyxXQUFXLEVBQUUsSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQTtBQUVqRSxNQUFNLE9BQU8sR0FBOEIsS0FBSyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLEVBQUU7SUFDN0UsTUFBTSxTQUFTLEdBQUcsSUFBSSx3QkFBUyxDQUFDLE9BQU8sRUFBRSxZQUFZLENBQUMsQ0FBQTtJQUN0RCxJQUFJLFNBQVMsQ0FBQyxLQUFLO1FBQUUsTUFBTSxTQUFTLENBQUMsS0FBSyxDQUFBO0lBQzFDLHdCQUFTLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBRTNCLE1BQU0sUUFBUSxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFBO0lBRXZDLDZEQUE2RDtJQUM3RCxTQUFTLGtCQUFrQixDQUFDLGVBQXVCO1FBQ2pELE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUE7UUFDdkIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsZUFBZSxDQUFDLENBQUE7UUFDOUMsT0FBTyxJQUFJLENBQUE7SUFDYixDQUFDO0lBRUQsTUFBTSxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUUsR0FBRyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUE7SUFFOUMsTUFBTSxRQUFRLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLHlCQUFnQixDQUFBO0lBQ3RFLE1BQU0sVUFBVSxHQUFHLGtCQUFrQixDQUNuQyxTQUFTLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxlQUFlLElBQUksNkJBQW9CLENBQ2pFLENBQUE7SUFDRCxNQUFNLElBQUksR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUkscUJBQVksQ0FBQTtJQUUxRCxNQUFNLE1BQU0sR0FBRyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLENBQUE7SUFFN0MsTUFBTSxhQUFhLEdBQUc7UUFDcEIsR0FBRyxNQUFNLENBQUMsR0FBRztRQUNiLEdBQUc7UUFDSCxNQUFNO1FBQ04sT0FBTyxFQUFFLEtBQUs7S0FDZixDQUFBO0lBQ0QsTUFBTSxRQUFRLEdBQUcsTUFBTSx3QkFBUyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsV0FBVyxDQUFDLENBQUE7SUFFcEUsUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsd0JBQVMsQ0FBQyxvQkFBb0I7SUFDbkQsMkVBQTJFO0lBQzNFLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQU0sRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxJQUFJLENBQUMsRUFDdkQsQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLEVBQ1osRUFBRSxPQUFPLEVBQUUsQ0FDWixDQUFBO0lBRUQsT0FBTyx3QkFBUyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQTtBQUM5RCxDQUFDLENBQUE7QUF4Q1ksUUFBQSxPQUFPLFdBd0NuQjtBQUVNLE1BQU0sV0FBVyxHQUEyQixDQUFDLE1BQU0sRUFBRSxFQUFFO0lBQzVELE9BQU8sS0FBSyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsRUFBRSxDQUFDLGVBQU8sQ0FBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sSUFBSSxtQkFBVSxFQUFFLENBQUMsQ0FBQTtBQUN0RixDQUFDLENBQUE7QUFGWSxRQUFBLFdBQVcsZUFFdkI7QUFFRCxNQUFNLFVBQVUsR0FBRyxDQUNqQixTQUFvQixFQUlwQixFQUFFO0lBQ0YsTUFBTSxJQUFJLEdBQUcsU0FBUyxDQUFDLGNBQWMsQ0FBQyxhQUFXLENBQVcsQ0FBQTtJQUM1RCxNQUFNLEtBQUssR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUE7SUFDNUMsTUFBTSxRQUFRLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQyxRQUFRLElBQUksRUFBRSxDQUFBO0lBRW5ELE1BQU0sY0FBYyxHQUFHLGtCQUFrQixDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFBO0lBQzNFLE9BQU8sQ0FDTCxjQUFjLElBQUk7UUFDaEIsR0FBRyxFQUFFLFNBQVMsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDO0tBQzVCLENBQ0YsQ0FBQTtBQUNILENBQUMsQ0FBQTtBQUVELE1BQU0sa0JBQWtCLEdBQUcsQ0FDekIsU0FBb0IsRUFDcEIsSUFBWSxFQUNaLEVBQVUsRUFDVixRQUErQixFQUMvQixFQUFFO0lBQ0YsTUFBTSxPQUFPLEdBQUcsV0FBVyxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLFFBQVEsQ0FBQyxDQUFBO0lBQzFELElBQUksQ0FBQyxPQUFPO1FBQUUsT0FBTyxTQUFTLENBQUE7SUFDOUIsT0FBTztRQUNMLEdBQUcsRUFBRSxTQUFTLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsRUFBRSxDQUFDO1FBQ3hDLE9BQU8sRUFBRSxPQUFPLENBQUMsT0FBTztLQUN6QixDQUFBO0FBQ0gsQ0FBQyxDQUFBO0FBRUQsTUFBTSxXQUFXLEdBQUcsQ0FDbEIsU0FBb0IsRUFDcEIsSUFBWSxFQUNaLEVBQVUsRUFDVixRQUErQixFQUNOLEVBQUU7SUFDM0IsSUFBSSxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUM7UUFBRSxPQUFPLFNBQVMsQ0FBQTtJQUUzQyxNQUFNLGNBQWMsR0FBRyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsYUFBVyxFQUFFLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQTtJQUN4RSxJQUFJLGNBQWMsSUFBSSxPQUFPLFFBQVEsQ0FBQyxDQUFDLENBQUMsS0FBSyxRQUFRO1FBQUUsT0FBTyxjQUFjLENBQUE7U0FDdkUsSUFBSSxPQUFPLFFBQVEsQ0FBQyxDQUFDLENBQUMsS0FBSyxRQUFRLEVBQUU7UUFDeEMsT0FBTztZQUNMLElBQUk7WUFDSixFQUFFLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUNmLE9BQU8sRUFBRSxLQUFLO1NBQ2YsQ0FBQTtLQUNGO0lBQ0QsT0FBTyxjQUFjLENBQUE7QUFDdkIsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVxdWVzdGVyLCBWYWxpZGF0b3IgfSBmcm9tICdAY2hhaW5saW5rL2VhLWJvb3RzdHJhcCdcbmltcG9ydCB7IENvbmZpZywgRXhlY3V0ZVdpdGhDb25maWcsIEV4ZWN1dGVGYWN0b3J5LCBJbmNsdWRlcywgSW5jbHVkZVBhaXIgfSBmcm9tICdAY2hhaW5saW5rL3R5cGVzJ1xuaW1wb3J0IHtcbiAgREVGQVVMVF9JTlRFUlZBTCxcbiAgREVGQVVMVF9TT1JULFxuICBERUZBVUxUX01JTExJU0VDT05EUyxcbiAgbWFrZUNvbmZpZyxcbiAgTkFNRSBhcyBBZGFwdGVyTmFtZSxcbn0gZnJvbSAnLi9jb25maWcnXG5cbmNvbnN0IGN1c3RvbUVycm9yID0gKGRhdGE6IGFueSkgPT4gZGF0YS5yZXN1bHQgPT09ICdlcnJvcidcblxuY29uc3QgY3VzdG9tUGFyYW1zID0ge1xuICBiYXNlOiBbJ2Jhc2UnLCAnZnJvbScsICdjb2luJ10sXG4gIHF1b3RlOiBbJ3F1b3RlJywgJ3RvJywgJ21hcmtldCddLFxuICBpbmNsdWRlczogZmFsc2UsXG4gIGludGVydmFsOiBmYWxzZSxcbiAgc29ydDogZmFsc2UsXG4gIG1pbGxpc2Vjb25kc0FnbzogZmFsc2UsXG59XG5cbmNvbnN0IHN5bWJvbFVybCA9IChmcm9tOiBzdHJpbmcsIHRvOiBzdHJpbmcpID0+XG4gIHRvLnRvTG93ZXJDYXNlKCkgPT09ICdldGgnXG4gICAgPyBkaXJlY3RVcmwoZnJvbSwgdG8pXG4gICAgOiBgL3Nwb3RfZXhjaGFuZ2VfcmF0ZS8ke2Zyb20udG9Mb3dlckNhc2UoKX0vJHt0by50b0xvd2VyQ2FzZSgpfWBcblxuY29uc3QgZGlyZWN0VXJsID0gKGZyb206IHN0cmluZywgdG86IHN0cmluZykgPT5cbiAgYC9zcG90X2RpcmVjdF9leGNoYW5nZV9yYXRlLyR7ZnJvbS50b0xvd2VyQ2FzZSgpfS8ke3RvLnRvTG93ZXJDYXNlKCl9YFxuXG5leHBvcnQgY29uc3QgZXhlY3V0ZTogRXhlY3V0ZVdpdGhDb25maWc8Q29uZmlnPiA9IGFzeW5jIChyZXF1ZXN0LCBfLCBjb25maWcpID0+IHtcbiAgY29uc3QgdmFsaWRhdG9yID0gbmV3IFZhbGlkYXRvcihyZXF1ZXN0LCBjdXN0b21QYXJhbXMpXG4gIGlmICh2YWxpZGF0b3IuZXJyb3IpIHRocm93IHZhbGlkYXRvci5lcnJvclxuICBSZXF1ZXN0ZXIubG9nQ29uZmlnKGNvbmZpZylcblxuICBjb25zdCBqb2JSdW5JRCA9IHZhbGlkYXRvci52YWxpZGF0ZWQuaWRcblxuICAvLyBwcm92aWRlIGEgcmVhc29uYWJsZSBpbnRlcnZhbCB0byBmZXRjaCBvbmx5IHJlY2VudCByZXN1bHRzXG4gIGZ1bmN0aW9uIGNhbGN1bGF0ZVN0YXJ0VGltZShtaWxsaXNlY29uZHNBZ286IG51bWJlcikge1xuICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpXG4gICAgZGF0ZS5zZXRUaW1lKGRhdGUuZ2V0VGltZSgpIC0gbWlsbGlzZWNvbmRzQWdvKVxuICAgIHJldHVybiBkYXRlXG4gIH1cblxuICBjb25zdCB7IHVybCwgaW52ZXJzZSB9ID0gZ2V0T3B0aW9ucyh2YWxpZGF0b3IpXG5cbiAgY29uc3QgaW50ZXJ2YWwgPSB2YWxpZGF0b3IudmFsaWRhdGVkLmRhdGEuaW50ZXJ2YWwgfHwgREVGQVVMVF9JTlRFUlZBTFxuICBjb25zdCBzdGFydF90aW1lID0gY2FsY3VsYXRlU3RhcnRUaW1lKFxuICAgIHZhbGlkYXRvci52YWxpZGF0ZWQuZGF0YS5taWxsaXNlY29uZHNBZ28gfHwgREVGQVVMVF9NSUxMSVNFQ09ORFMsXG4gIClcbiAgY29uc3Qgc29ydCA9IHZhbGlkYXRvci52YWxpZGF0ZWQuZGF0YS5zb3J0IHx8IERFRkFVTFRfU09SVFxuXG4gIGNvbnN0IHBhcmFtcyA9IHsgaW50ZXJ2YWwsIHNvcnQsIHN0YXJ0X3RpbWUgfVxuXG4gIGNvbnN0IHJlcXVlc3RDb25maWcgPSB7XG4gICAgLi4uY29uZmlnLmFwaSxcbiAgICB1cmwsXG4gICAgcGFyYW1zLFxuICAgIHRpbWVvdXQ6IDEwMDAwLFxuICB9XG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUmVxdWVzdGVyLnJlcXVlc3QocmVxdWVzdENvbmZpZywgY3VzdG9tRXJyb3IpXG5cbiAgcmVzcG9uc2UuZGF0YS5yZXN1bHQgPSBSZXF1ZXN0ZXIudmFsaWRhdGVSZXN1bHROdW1iZXIoXG4gICAgLy8gc29tZXRpbWVzLCB0aGUgbW9zdCByZWNlbnQoZnJhY3Rpb24gb2YgYSBzZWNvbmQpIGRhdGEgY29udGFpbiBudWxsIHByaWNlXG4gICAgcmVzcG9uc2UuZGF0YS5kYXRhLmZpbHRlcigoeDogYW55KSA9PiB4LnByaWNlICE9PSBudWxsKSxcbiAgICBbMCwgJ3ByaWNlJ10sXG4gICAgeyBpbnZlcnNlIH0sXG4gIClcblxuICByZXR1cm4gUmVxdWVzdGVyLnN1Y2Nlc3Moam9iUnVuSUQsIHJlc3BvbnNlLCBjb25maWcudmVyYm9zZSlcbn1cblxuZXhwb3J0IGNvbnN0IG1ha2VFeGVjdXRlOiBFeGVjdXRlRmFjdG9yeTxDb25maWc+ID0gKGNvbmZpZykgPT4ge1xuICByZXR1cm4gYXN5bmMgKHJlcXVlc3QsIGNvbnRleHQpID0+IGV4ZWN1dGUocmVxdWVzdCwgY29udGV4dCwgY29uZmlnIHx8IG1ha2VDb25maWcoKSlcbn1cblxuY29uc3QgZ2V0T3B0aW9ucyA9IChcbiAgdmFsaWRhdG9yOiBWYWxpZGF0b3IsXG4pOiB7XG4gIHVybDogc3RyaW5nXG4gIGludmVyc2U/OiBib29sZWFuXG59ID0+IHtcbiAgY29uc3QgYmFzZSA9IHZhbGlkYXRvci5vdmVycmlkZVN5bWJvbChBZGFwdGVyTmFtZSkgYXMgc3RyaW5nXG4gIGNvbnN0IHF1b3RlID0gdmFsaWRhdG9yLnZhbGlkYXRlZC5kYXRhLnF1b3RlXG4gIGNvbnN0IGluY2x1ZGVzID0gdmFsaWRhdG9yLnZhbGlkYXRlZC5pbmNsdWRlcyB8fCBbXVxuXG4gIGNvbnN0IGluY2x1ZGVPcHRpb25zID0gZ2V0SW5jbHVkZXNPcHRpb25zKHZhbGlkYXRvciwgYmFzZSwgcXVvdGUsIGluY2x1ZGVzKVxuICByZXR1cm4gKFxuICAgIGluY2x1ZGVPcHRpb25zID8/IHtcbiAgICAgIHVybDogc3ltYm9sVXJsKGJhc2UsIHF1b3RlKSxcbiAgICB9XG4gIClcbn1cblxuY29uc3QgZ2V0SW5jbHVkZXNPcHRpb25zID0gKFxuICB2YWxpZGF0b3I6IFZhbGlkYXRvcixcbiAgZnJvbTogc3RyaW5nLFxuICB0bzogc3RyaW5nLFxuICBpbmNsdWRlczogc3RyaW5nW10gfCBJbmNsdWRlc1tdLFxuKSA9PiB7XG4gIGNvbnN0IGluY2x1ZGUgPSBnZXRJbmNsdWRlcyh2YWxpZGF0b3IsIGZyb20sIHRvLCBpbmNsdWRlcylcbiAgaWYgKCFpbmNsdWRlKSByZXR1cm4gdW5kZWZpbmVkXG4gIHJldHVybiB7XG4gICAgdXJsOiBkaXJlY3RVcmwoaW5jbHVkZS5mcm9tLCBpbmNsdWRlLnRvKSxcbiAgICBpbnZlcnNlOiBpbmNsdWRlLmludmVyc2UsXG4gIH1cbn1cblxuY29uc3QgZ2V0SW5jbHVkZXMgPSAoXG4gIHZhbGlkYXRvcjogVmFsaWRhdG9yLFxuICBmcm9tOiBzdHJpbmcsXG4gIHRvOiBzdHJpbmcsXG4gIGluY2x1ZGVzOiBzdHJpbmdbXSB8IEluY2x1ZGVzW10sXG4pOiBJbmNsdWRlUGFpciB8IHVuZGVmaW5lZCA9PiB7XG4gIGlmIChpbmNsdWRlcy5sZW5ndGggPT09IDApIHJldHVybiB1bmRlZmluZWRcblxuICBjb25zdCBwcmVzZXRJbmNsdWRlcyA9IHZhbGlkYXRvci5vdmVycmlkZUluY2x1ZGVzKEFkYXB0ZXJOYW1lLCBmcm9tLCB0bylcbiAgaWYgKHByZXNldEluY2x1ZGVzICYmIHR5cGVvZiBpbmNsdWRlc1swXSA9PT0gJ3N0cmluZycpIHJldHVybiBwcmVzZXRJbmNsdWRlc1xuICBlbHNlIGlmICh0eXBlb2YgaW5jbHVkZXNbMF0gPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGZyb20sXG4gICAgICB0bzogaW5jbHVkZXNbMF0sXG4gICAgICBpbnZlcnNlOiBmYWxzZSxcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHByZXNldEluY2x1ZGVzXG59XG4iXX0=