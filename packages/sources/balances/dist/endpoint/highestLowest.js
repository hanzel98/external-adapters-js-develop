"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.execute = exports.inputParameters = exports.endpointResultPaths = exports.supportedEndpoints = void 0;
const ea_bootstrap_1 = require("@chainlink/ea-bootstrap");
const config_1 = require("../config");
// Call this endpont to execute the highestLowest function
exports.supportedEndpoints = ['highest-lowest'];
exports.endpointResultPaths = {};
const customError = (data) => data.Response === 'Error';
exports.inputParameters = {}; // Not needed
// Validate that some values were received
const validateResponse = (response) => {
    const accounts = response.data;
    if (!accounts || accounts.length === 0) {
        throw Error('There are no accounts with balance');
    }
};
// Validate the correct values in the result path
const validateResultPath = (resultPath = []) => {
    const allowedPath1 = ['lowest', 'highest'];
    // Validates that the path value is in the expected values
    if (resultPath[0] && !allowedPath1.includes(resultPath[0])) {
        throw Error(`Path is invalid, this property does not exist: ${resultPath[0]}`);
    }
};
const includeSplittedAddress = (account) => {
    if (!account) {
        throw Error(`Unable to find values`);
    }
    const accountCopy = { ...account };
    const accountAddressLength = accountCopy.address.length;
    const halfElementIndex = Math.round(accountAddressLength / 2);
    accountCopy.address1 = accountCopy.address.substr(0, halfElementIndex);
    accountCopy.address2 = accountCopy.address.substr(halfElementIndex, accountAddressLength - 1);
    return accountCopy;
};
const calculateHighestLowest = (results) => {
    // Calculates the highest and lowest values obtained in the query response
    // Assign the first value as highest and lowest to compare later
    let highest = results[0];
    let lowest = results[0];
    results.forEach((element) => {
        if (element.balance > highest.balance)
            highest = element; // Compares previous highest with current
        if (element.balance < lowest.balance)
            lowest = element; // Compares previous lowest with current
    });
    return [highest, lowest];
};
const execute = async (request, _, config) => {
    const validator = new ea_bootstrap_1.Validator(request);
    if (validator.error)
        throw validator.error;
    const jobRunID = validator.validated.id;
    // No special url or query needed to call the API
    const options = {
        ...config.api,
        baseURL: config_1.DEFAULT_API_ENDPOINT,
        url: '',
    };
    const response = await ea_bootstrap_1.Requester.request(options, customError);
    validateResponse(response);
    const results = response.data;
    let [highest, lowest] = calculateHighestLowest(results);
    highest = includeSplittedAddress(highest);
    lowest = includeSplittedAddress(lowest);
    // Properties highest/lowest include address and balance
    response.data = { highest, lowest }; // Insert results in the response
    const resultPath = validator.validated.data.resultPath;
    let result = { highest, lowest };
    if (resultPath) { // Result path was specified
        validateResultPath(resultPath);
        result = response.data[resultPath[0]].address; // Formatting the output
        return ea_bootstrap_1.Requester.success(jobRunID, ea_bootstrap_1.Requester.withResult(response, result), config.verbose);
    }
    return ea_bootstrap_1.Requester.success(jobRunID, ea_bootstrap_1.Requester.withResult(response, result), config.verbose);
};
exports.execute = execute;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGlnaGVzdExvd2VzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lbmRwb2ludC9oaWdoZXN0TG93ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDBEQUE4RDtBQUU5RCxzQ0FBZ0Q7QUFFaEQsMERBQTBEO0FBQzdDLFFBQUEsa0JBQWtCLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBO0FBRXZDLFFBQUEsbUJBQW1CLEdBQUcsRUFBRSxDQUFBO0FBRXJDLE1BQU0sV0FBVyxHQUFHLENBQUMsSUFBUyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxLQUFLLE9BQU8sQ0FBQTtBQUUvQyxRQUFBLGVBQWUsR0FBb0IsRUFBRSxDQUFBLENBQUMsYUFBYTtBQUVoRSwwQ0FBMEM7QUFDMUMsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLFFBQTBCLEVBQUUsRUFBRTtJQUN0RCxNQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFBO0lBQzlCLElBQUksQ0FBQyxRQUFRLElBQUksUUFBUSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7UUFDdEMsTUFBTSxLQUFLLENBQUMsb0NBQW9DLENBQUMsQ0FBQTtLQUNsRDtBQUNILENBQUMsQ0FBQTtBQUVELGlEQUFpRDtBQUNqRCxNQUFNLGtCQUFrQixHQUFHLENBQUMsYUFBdUIsRUFBRSxFQUFFLEVBQUU7SUFDdkQsTUFBTSxZQUFZLEdBQWEsQ0FBQyxRQUFRLEVBQUUsU0FBUyxDQUFDLENBQUE7SUFDcEQsMERBQTBEO0lBQzFELElBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBQztRQUN4RCxNQUFNLEtBQUssQ0FBQyxrREFBa0QsVUFBVSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQTtLQUMvRTtBQUNILENBQUMsQ0FBQTtBQVNELE1BQU0sc0JBQXNCLEdBQUcs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QUFrQixDQUFDLFVBQVUsQ0FBQyxDQUFBO1FBQzlCLE1BQU0sR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQSxDQUFDLHdCQUF3QjtRQUN0RSxPQUFPLHdCQUFTLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSx3QkFBUyxDQUFDLFVBQVUsQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0tBQzNGO0lBQ0QsT0FBTyx3QkFBUyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsd0JBQVMsQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQTtBQUU1RixDQUFDLENBQUE7QUEvQlksUUFBQSxPQUFPLFdBK0JuQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlcXVlc3RlciwgVmFsaWRhdG9yIH0gZnJvbSAnQGNoYWlubGluay9lYS1ib290c3RyYXAnXG5pbXBvcnQgeyBDb25maWcsIEV4ZWN1dGVXaXRoQ29uZmlnLCBJbnB1dFBhcmFtZXRlcnMgfSBmcm9tICdAY2hhaW5saW5rL3R5cGVzJ1xuaW1wb3J0IHsgREVGQVVMVF9BUElfRU5EUE9JTlQgfSBmcm9tICcuLi9jb25maWcnXG5cbi8vIENhbGwgdGhpcyBlbmRwb250IHRvIGV4ZWN1dGUgdGhlIGhpZ2hlc3RMb3dlc3QgZnVuY3Rpb25cbmV4cG9ydCBjb25zdCBzdXBwb3J0ZWRFbmRwb2ludHMgPSBbJ2hpZ2hlc3QtbG93ZXN0J10gXG5cbmV4cG9ydCBjb25zdCBlbmRwb2ludFJlc3VsdFBhdGhzID0ge31cblxuY29uc3QgY3VzdG9tRXJyb3IgPSAoZGF0YTogYW55KSA9PiBkYXRhLlJlc3BvbnNlID09PSAnRXJyb3InXG5cbmV4cG9ydCBjb25zdCBpbnB1dFBhcmFtZXRlcnM6IElucHV0UGFyYW1ldGVycyA9IHt9IC8vIE5vdCBuZWVkZWRcblxuLy8gVmFsaWRhdGUgdGhhdCBzb21lIHZhbHVlcyB3ZXJlIHJlY2VpdmVkXG5jb25zdCB2YWxpZGF0ZVJlc3BvbnNlID0gKHJlc3BvbnNlOiB7ZGF0YTogbnVtYmVyW119KSA9PiB7XG4gIGNvbnN0IGFjY291bnRzID0gcmVzcG9uc2UuZGF0YVxuICBpZiAoIWFjY291bnRzIHx8IGFjY291bnRzLmxlbmd0aCA9PT0gMCkge1xuICAgIHRocm93IEVycm9yKCdUaGVyZSBhcmUgbm8gYWNjb3VudHMgd2l0aCBiYWxhbmNlJylcbiAgfVxufVxuXG4vLyBWYWxpZGF0ZSB0aGUgY29ycmVjdCB2YWx1ZXMgaW4gdGhlIHJlc3VsdCBwYXRoXG5jb25zdCB2YWxpZGF0ZVJlc3VsdFBhdGggPSAocmVzdWx0UGF0aDogc3RyaW5nW10gPSBbXSkgPT4ge1xuICBjb25zdCBhbGxvd2VkUGF0aDE6IHN0cmluZ1tdID0gWydsb3dlc3QnLCAnaGlnaGVzdCddXG4gIC8vIFZhbGlkYXRlcyB0aGF0IHRoZSBwYXRoIHZhbHVlIGlzIGluIHRoZSBleHBlY3RlZCB2YWx1ZXNcbiAgaWYocmVzdWx0UGF0aFswXSAmJiAhYWxsb3dlZFBhdGgxLmluY2x1ZGVzKHJlc3VsdFBhdGhbMF0pKXtcbiAgICB0aHJvdyBFcnJvcihgUGF0aCBpcyBpbnZhbGlkLCB0aGlzIHByb3BlcnR5IGRvZXMgbm90IGV4aXN0OiAke3Jlc3VsdFBhdGhbMF19YClcbiAgfVxufVxuXG5pbnRlcmZhY2UgSUFjY291bnRSZXN1bHQge1xuICBhZGRyZXNzOiBzdHJpbmcsXG4gIGJhbGFuY2U6IG51bWJlcixcbiAgYWRkcmVzczE/OiBzdHJpbmcsXG4gIGFkZHJlc3MyPzogc3RyaW5nLFxuXG59XG5jb25zdCBpbmNsdWRlU3BsaXR0ZWRBZGRyZXNzID0gKGFjY291bnQ6IElBY2NvdW50UmVzdWx0KTogSUFjY291bnRSZXN1bHQgPT4ge1xuICBpZighYWNjb3VudCkge1xuICAgIHRocm93IEVycm9yKGBVbmFibGUgdG8gZmluZCB2YWx1ZXNgKVxuICB9XG4gIGNvbnN0IGFjY291bnRDb3B5OiBJQWNjb3VudFJlc3VsdCA9IHsuLi5hY2NvdW50fVxuICBjb25zdCBhY2NvdW50QWRkcmVzc0xlbmd0aCA9IGFjY291bnRDb3B5LmFkZHJlc3MubGVuZ3RoXG4gIGNvbnN0IGhhbGZFbGVtZW50SW5kZXggPSBNYXRoLnJvdW5kKGFjY291bnRBZGRyZXNzTGVuZ3RoLzIpXG4gIGFjY291bnRDb3B5LmFkZHJlc3MxID0gYWNjb3VudENvcHkuYWRkcmVzcy5zdWJzdHIoMCwgaGFsZkVsZW1lbnRJbmRleClcbiAgYWNjb3VudENvcHkuYWRkcmVzczIgPSBhY2NvdW50Q29weS5hZGRyZXNzLnN1YnN0cihoYWxmRWxlbWVudEluZGV4LCBhY2NvdW50QWRkcmVzc0xlbmd0aC0xKVxuICByZXR1cm4gYWNjb3VudENvcHlcbn1cbmNvbnN0IGNhbGN1bGF0ZUhpZ2hlc3RMb3dlc3QgPSAocmVzdWx0czogSUFjY291bnRSZXN1bHRbXSk6IElBY2NvdW50UmVzdWx0W10gPT57XG4gIC8vIENhbGN1bGF0ZXMgdGhlIGhpZ2hlc3QgYW5kIGxvd2VzdCB2YWx1ZXMgb2J0YWluZWQgaW4gdGhlIHF1ZXJ5IHJlc3BvbnNlXG4gIC8vIEFzc2lnbiB0aGUgZmlyc3QgdmFsdWUgYXMgaGlnaGVzdCBhbmQgbG93ZXN0IHRvIGNvbXBhcmUgbGF0ZXJcbiAgbGV0IGhpZ2hlc3Q6IElBY2NvdW50UmVzdWx0ID0gcmVzdWx0c1swXVxuICBsZXQgbG93ZXN0OiBJQWNjb3VudFJlc3VsdCA9IHJlc3VsdHNbMF1cbiAgcmVzdWx0cy5mb3JFYWNoKChlbGVtZW50OklBY2NvdW50UmVzdWx0KSA9PiB7IC8vIFRPRE86IGNvbnNpZGVyIGJpZyBudW1iZXJzXG4gICAgICBpZihlbGVtZW50LmJhbGFuY2UgPiBoaWdoZXN0LmJhbGFuY2UpIGhpZ2hlc3QgPSBlbGVtZW50IC8vIENvbXBhcmVzIHByZXZpb3VzIGhpZ2hlc3Qgd2l0aCBjdXJyZW50XG4gICAgICBpZihlbGVtZW50LmJhbGFuY2UgPCBsb3dlc3QuYmFsYW5jZSkgbG93ZXN0ID0gZWxlbWVudCAgLy8gQ29tcGFyZXMgcHJldmlvdXMgbG93ZXN0IHdpdGggY3VycmVudFxuICB9KVxuXG4gIHJldHVybiBbaGlnaGVzdCwgbG93ZXN0XVxufVxuXG5cbmV4cG9ydCBjb25zdCBleGVjdXRlOiBFeGVjdXRlV2l0aENvbmZpZzxDb25maWc+ID0gYXN5bmMgKHJlcXVlc3Q6IGFueSwgXzogYW55LCBjb25maWc6IGFueSkgPT4ge1xuICBjb25zdCB2YWxpZGF0b3IgPSBuZXcgVmFsaWRhdG9yKHJlcXVlc3QpXG4gIGlmICh2YWxpZGF0b3IuZXJyb3IpIHRocm93IHZhbGlkYXRvci5lcnJvclxuXG4gIGNvbnN0IGpvYlJ1bklEID0gdmFsaWRhdG9yLnZhbGlkYXRlZC5pZFxuICAvLyBObyBzcGVjaWFsIHVybCBvciBxdWVyeSBuZWVkZWQgdG8gY2FsbCB0aGUgQVBJXG4gIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgLi4uY29uZmlnLmFwaSxcbiAgICBiYXNlVVJMOiBERUZBVUxUX0FQSV9FTkRQT0lOVCxcbiAgICB1cmw6ICcnLFxuICB9XG5cbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBSZXF1ZXN0ZXIucmVxdWVzdChvcHRpb25zLCBjdXN0b21FcnJvcilcbiAgdmFsaWRhdGVSZXNwb25zZShyZXNwb25zZSlcblxuICBjb25zdCByZXN1bHRzOiBJQWNjb3VudFJlc3VsdFtdID0gcmVzcG9uc2UuZGF0YVxuICBsZXQgW2hpZ2hlc3QsIGxvd2VzdF0gPSBjYWxjdWxhdGVIaWdoZXN0TG93ZXN0KHJlc3VsdHMpXG4gIGhpZ2hlc3QgPSBpbmNsdWRlU3BsaXR0ZWRBZGRyZXNzKGhpZ2hlc3QpXG4gIGxvd2VzdCA9IGluY2x1ZGVTcGxpdHRlZEFkZHJlc3MobG93ZXN0KVxuICAvLyBQcm9wZXJ0aWVzIGhpZ2hlc3QvbG93ZXN0IGluY2x1ZGUgYWRkcmVzcyBhbmQgYmFsYW5jZVxuICByZXNwb25zZS5kYXRhID0geyBoaWdoZXN0LCBsb3dlc3QgfSAvLyBJbnNlcnQgcmVzdWx0cyBpbiB0aGUgcmVzcG9uc2VcblxuICBjb25zdCByZXN1bHRQYXRoID0gdmFsaWRhdG9yLnZhbGlkYXRlZC5kYXRhLnJlc3VsdFBhdGhcbiAgbGV0IHJlc3VsdDogYW55ID0geyBoaWdoZXN0LCBsb3dlc3QgfVxuICBpZihyZXN1bHRQYXRoKXsgIC8vIFJlc3VsdCBwYXRoIHdhcyBzcGVjaWZpZWRcbiAgICB2YWxpZGF0ZVJlc3VsdFBhdGgocmVzdWx0UGF0aClcbiAgICByZXN1bHQgPSByZXNwb25zZS5kYXRhW3Jlc3VsdFBhdGhbMF1dLmFkZHJlc3MgLy8gRm9ybWF0dGluZyB0aGUgb3V0cHV0XG4gICAgcmV0dXJuIFJlcXVlc3Rlci5zdWNjZXNzKGpvYlJ1bklELCBSZXF1ZXN0ZXIud2l0aFJlc3VsdChyZXNwb25zZSwgcmVzdWx0KSwgY29uZmlnLnZlcmJvc2UpXG4gIH1cbiAgcmV0dXJuIFJlcXVlc3Rlci5zdWNjZXNzKGpvYlJ1bklELCBSZXF1ZXN0ZXIud2l0aFJlc3VsdChyZXNwb25zZSwgcmVzdWx0KSwgY29uZmlnLnZlcmJvc2UpXG5cbn0iXX0=