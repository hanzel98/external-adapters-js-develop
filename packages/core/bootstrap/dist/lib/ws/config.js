"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.wsRedactPaths = exports.getWSConfig = void 0;
const util_1 = require("../util");
const ENV_WS_ENABLED = 'WS_ENABLED';
// WSConnectionInfo
const ENV_WS_CONNECTION_KEY = 'WS_CONNECTION_KEY';
// WSConfig
const ENV_WS_CONNECTION_LIMIT = 'WS_CONNECTION_LIMIT';
const ENV_WS_CONNECTION_TTL = 'WS_CONNECTION_TTL';
const ENV_WS_CONNECTION_RETRY_LIMIT = 'WS_CONNECTION_RETRY_LIMIT';
const ENV_WS_CONNECTION_RETRY_DELAY = 'WS_CONNECTION_RETRY_DELAY';
const ENV_WS_SUBSCRIPTION_LIMIT = 'WS_SUBSCRIPTION_LIMIT';
const ENV_WS_SUBSCRIPTION_TTL = 'WS_SUBSCRIPTION_TTL';
const ENV_WS_SUBSCRIPTION_UNRESPONSIVE_TTL = 'WS_SUBSCRIPTION_UNRESPONSIVE_TTL';
const ENV_WS_SUBSCRIPTION_PRIORITY_LIST = 'WS_SUBSCRIPTION_PRIORITY_LIST';
// WSConfig defaults
const DEFAULT_WS_CONNECTION_LIMIT = 1;
const DEFAULT_WS_CONNECTION_TTL = 70000;
const DEFAULT_WS_CONNECTION_RETRY_LIMIT = 3;
const DEFAULT_WS_CONNECTION_RETRY_DELAY = 1000;
const DEFAULT_WS_SUBSCRIPTION_LIMIT = 10;
const DEFAULT_WS_SUBSCRIPTION_TTL = 120000;
const DEFAULT_WS_SUBSCRIPTION_UNRESPONSIVE_TTL = 120000;
const DEFAULT_WS_HEARTBEAT_INTERVAL = 30000;
/** Load WSConfig from environment variables */
const getWSConfig = (endpoint) => ({
    enabled: util_1.parseBool(util_1.getEnv(ENV_WS_ENABLED)),
    connectionInfo: {
        key: `${util_1.getEnv(ENV_WS_CONNECTION_KEY) || '1'}-${endpoint}`,
    },
    connectionLimit: Number(util_1.getEnv(ENV_WS_CONNECTION_LIMIT)) || DEFAULT_WS_CONNECTION_LIMIT,
    connectionTTL: Number(util_1.getEnv(ENV_WS_CONNECTION_TTL)) || DEFAULT_WS_CONNECTION_TTL,
    connectionRetryLimit: Number(util_1.getEnv(ENV_WS_CONNECTION_RETRY_LIMIT)) || DEFAULT_WS_CONNECTION_RETRY_LIMIT,
    connectionRetryDelay: Number(util_1.getEnv(ENV_WS_CONNECTION_RETRY_DELAY)) || DEFAULT_WS_CONNECTION_RETRY_DELAY,
    subscriptionLimit: Number(util_1.getEnv(ENV_WS_SUBSCRIPTION_LIMIT)) || DEFAULT_WS_SUBSCRIPTION_LIMIT,
    subscriptionTTL: Number(util_1.getEnv(ENV_WS_SUBSCRIPTION_TTL)) || DEFAULT_WS_SUBSCRIPTION_TTL,
    subscriptionUnresponsiveTTL: Number(util_1.getEnv(ENV_WS_SUBSCRIPTION_UNRESPONSIVE_TTL)) ||
        DEFAULT_WS_SUBSCRIPTION_UNRESPONSIVE_TTL,
    subscriptionPriorityList: (util_1.getEnv(ENV_WS_SUBSCRIPTION_PRIORITY_LIST) || []),
    defaultHeartbeatIntervalInMS: Number(util_1.getEnv('DEFAULT_WS_HEARTBEAT_INTERVAL') || DEFAULT_WS_HEARTBEAT_INTERVAL),
});
exports.getWSConfig = getWSConfig;
exports.wsRedactPaths = [
    'payload.wsHandler.connection.protocol.query.api_key',
    'payload.connectionInfo.url',
    'payload.wsHandler.connection.url',
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYi93cy9jb25maWcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsa0NBQTJDO0FBRzNDLE1BQU0sY0FBYyxHQUFHLFlBQVksQ0FBQTtBQUVuQyxtQkFBbUI7QUFDbkIsTUFBTSxxQkFBcUIsR0FBRyxtQkFBbUIsQ0FBQTtBQUVqRCxXQUFXO0FBQ1gsTUFBTSx1QkFBdUIsR0FBRyxxQkFBcUIsQ0FBQTtBQUNyRCxNQUFNLHFCQUFxQixHQUFHLG1CQUFtQixDQUFBO0FBQ2pELE1BQU0sNkJBQTZCLEdBQUcsMkJBQTJCLENBQUE7QUFDakUsTUFBTSw2QkFBNkIsR0FBRywyQkFBMkIsQ0FBQTtBQUNqRSxNQUFNLHlCQUF5QixHQUFHLHVCQUF1QixDQUFBO0FBQ3pELE1BQU0sdUJBQXVCLEdBQUcscUJBQXFCLENBQUE7QUFDckQsTUFBTSxvQ0FBb0MsR0FBRyxrQ0FBa0MsQ0FBQTtBQUMvRSxNQUFNLGlDQUFpQyxHQUFHLCtCQUErQixDQUFBO0FBRXpFLG9CQUFvQjtBQUNwQixNQUFNLDJCQUEyQixHQUFHLENBQUMsQ0FBQTtBQUNyQyxNQUFNLHlCQUF5QixHQUFHLEtBQUssQ0FBQTtBQUN2QyxNQUFNLGlDQUFpQyxHQUFHLENBQUMsQ0FBQTtBQUMzQyxNQUFNLGlDQUFpQyxHQUFHLElBQUksQ0FBQTtBQUM5QyxNQUFNLDZCQUE2QixHQUFHLEVBQUUsQ0FBQTtBQUN4QyxNQUFNLDJCQUEyQixHQUFHLE1BQU0sQ0FBQTtBQUMxQyxNQUFNLHdDQUF3QyxHQUFHLE1BQU0sQ0FBQTtBQUN2RCxNQUFNLDZCQUE2QixHQUFHLEtBQUssQ0FBQTtBQUUzQywrQ0FBK0M7QUFDeEMsTUFBTSxXQUFXLEdBQUcsQ0FBQyxRQUFpQixFQUFZLEVBQUUsQ0FBQyxDQUFDO0lBQzNELE9BQU8sRUFBRSxnQkFBUyxDQUFDLGFBQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUMxQyxjQUFjLEVBQUU7UUFDZCxHQUFHLEVBQUUsR0FBRyxhQUFNLENBQUMscUJBQXFCLENBQUMsSUFBSSxHQUFHLElBQUksUUFBUSxFQUFFO0tBQzNEO0lBQ0QsZUFBZSxFQUFFLE1BQU0sQ0FBQyxhQUFNLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxJQUFJLDJCQUEyQjtJQUN2RixhQUFhLEVBQUUsTUFBTSxDQUFDLGFBQU0sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLElBQUkseUJBQXlCO0lBQ2pGLG9CQUFvQixFQUNsQixNQUFNLENBQUMsYUFBTSxDQUFDLDZCQUE2QixDQUFDLENBQUMsSUFBSSxpQ0FBaUM7SUFDcEYsb0JBQW9CLEVBQ2xCLE1BQU0sQ0FBQyxhQUFNLENBQUMsNkJBQTZCLENBQUMsQ0FBQyxJQUFJLGlDQUFpQztJQUNwRixpQkFBaUIsRUFBRSxNQUFNLENBQUMsYUFBTSxDQUFDLHlCQUF5QixDQUFDLENBQUMsSUFBSSw2QkFBNkI7SUFDN0YsZUFBZSxFQUFFLE1BQU0sQ0FBQyxhQUFNLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxJQUFJLDJCQUEyQjtJQUN2RiwyQkFBMkIsRUFDekIsTUFBTSxDQUFDLGFBQU0sQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFDO1FBQ3BELHdDQUF3QztJQUMxQyx3QkFBd0IsRUFBRSxDQUFDLGFBQU0sQ0FBQyxpQ0FBaUMsQ0FBQyxJQUFJLEVBQUUsQ0FBa0I7SUFDNUYsNEJBQTRCLEVBQUUsTUFBTSxDQUNsQyxhQUFNLENBQUMsK0JBQStCLENBQUMsSUFBSSw2QkFBNkIsQ0FDekU7Q0FDRixDQUFDLENBQUE7QUFwQlcsUUFBQSxXQUFXLGVBb0J0QjtBQUVXLFFBQUEsYUFBYSxHQUFHO0lBQzNCLHFEQUFxRDtJQUNyRCw0QkFBNEI7SUFDNUIsa0NBQWtDO0NBQ25DLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRFbnYsIHBhcnNlQm9vbCB9IGZyb20gJy4uL3V0aWwnXG5pbXBvcnQgeyBXU0NvbmZpZyB9IGZyb20gJy4vdHlwZXMnXG5cbmNvbnN0IEVOVl9XU19FTkFCTEVEID0gJ1dTX0VOQUJMRUQnXG5cbi8vIFdTQ29ubmVjdGlvbkluZm9cbmNvbnN0IEVOVl9XU19DT05ORUNUSU9OX0tFWSA9ICdXU19DT05ORUNUSU9OX0tFWSdcblxuLy8gV1NDb25maWdcbmNvbnN0IEVOVl9XU19DT05ORUNUSU9OX0xJTUlUID0gJ1dTX0NPTk5FQ1RJT05fTElNSVQnXG5jb25zdCBFTlZfV1NfQ09OTkVDVElPTl9UVEwgPSAnV1NfQ09OTkVDVElPTl9UVEwnXG5jb25zdCBFTlZfV1NfQ09OTkVDVElPTl9SRVRSWV9MSU1JVCA9ICdXU19DT05ORUNUSU9OX1JFVFJZX0xJTUlUJ1xuY29uc3QgRU5WX1dTX0NPTk5FQ1RJT05fUkVUUllfREVMQVkgPSAnV1NfQ09OTkVDVElPTl9SRVRSWV9ERUxBWSdcbmNvbnN0IEVOVl9XU19TVUJTQ1JJUFRJT05fTElNSVQgPSAnV1NfU1VCU0NSSVBUSU9OX0xJTUlUJ1xuY29uc3QgRU5WX1dTX1NVQlNDUklQVElPTl9UVEwgPSAnV1NfU1VCU0NSSVBUSU9OX1RUTCdcbmNvbnN0IEVOVl9XU19TVUJTQ1JJUFRJT05fVU5SRVNQT05TSVZFX1RUTCA9ICdXU19TVUJTQ1JJUFRJT05fVU5SRVNQT05TSVZFX1RUTCdcbmNvbnN0IEVOVl9XU19TVUJTQ1JJUFRJT05fUFJJT1JJVFlfTElTVCA9ICdXU19TVUJTQ1JJUFRJT05fUFJJT1JJVFlfTElTVCdcblxuLy8gV1NDb25maWcgZGVmYXVsdHNcbmNvbnN0IERFRkFVTFRfV1NfQ09OTkVDVElPTl9MSU1JVCA9IDFcbmNvbnN0IERFRkFVTFRfV1NfQ09OTkVDVElPTl9UVEwgPSA3MDAwMFxuY29uc3QgREVGQVVMVF9XU19DT05ORUNUSU9OX1JFVFJZX0xJTUlUID0gM1xuY29uc3QgREVGQVVMVF9XU19DT05ORUNUSU9OX1JFVFJZX0RFTEFZID0gMTAwMFxuY29uc3QgREVGQVVMVF9XU19TVUJTQ1JJUFRJT05fTElNSVQgPSAxMFxuY29uc3QgREVGQVVMVF9XU19TVUJTQ1JJUFRJT05fVFRMID0gMTIwMDAwXG5jb25zdCBERUZBVUxUX1dTX1NVQlNDUklQVElPTl9VTlJFU1BPTlNJVkVfVFRMID0gMTIwMDAwXG5jb25zdCBERUZBVUxUX1dTX0hFQVJUQkVBVF9JTlRFUlZBTCA9IDMwMDAwXG5cbi8qKiBMb2FkIFdTQ29uZmlnIGZyb20gZW52aXJvbm1lbnQgdmFyaWFibGVzICovXG5leHBvcnQgY29uc3QgZ2V0V1NDb25maWcgPSAoZW5kcG9pbnQ/OiBzdHJpbmcpOiBXU0NvbmZpZyA9PiAoe1xuICBlbmFibGVkOiBwYXJzZUJvb2woZ2V0RW52KEVOVl9XU19FTkFCTEVEKSksXG4gIGNvbm5lY3Rpb25JbmZvOiB7XG4gICAga2V5OiBgJHtnZXRFbnYoRU5WX1dTX0NPTk5FQ1RJT05fS0VZKSB8fCAnMSd9LSR7ZW5kcG9pbnR9YCxcbiAgfSxcbiAgY29ubmVjdGlvbkxpbWl0OiBOdW1iZXIoZ2V0RW52KEVOVl9XU19DT05ORUNUSU9OX0xJTUlUKSkgfHwgREVGQVVMVF9XU19DT05ORUNUSU9OX0xJTUlULFxuICBjb25uZWN0aW9uVFRMOiBOdW1iZXIoZ2V0RW52KEVOVl9XU19DT05ORUNUSU9OX1RUTCkpIHx8IERFRkFVTFRfV1NfQ09OTkVDVElPTl9UVEwsXG4gIGNvbm5lY3Rpb25SZXRyeUxpbWl0OlxuICAgIE51bWJlcihnZXRFbnYoRU5WX1dTX0NPTk5FQ1RJT05fUkVUUllfTElNSVQpKSB8fCBERUZBVUxUX1dTX0NPTk5FQ1RJT05fUkVUUllfTElNSVQsXG4gIGNvbm5lY3Rpb25SZXRyeURlbGF5OlxuICAgIE51bWJlcihnZXRFbnYoRU5WX1dTX0NPTk5FQ1RJT05fUkVUUllfREVMQVkpKSB8fCBERUZBVUxUX1dTX0NPTk5FQ1RJT05fUkVUUllfREVMQVksXG4gIHN1YnNjcmlwdGlvbkxpbWl0OiBOdW1iZXIoZ2V0RW52KEVOVl9XU19TVUJTQ1JJUFRJT05fTElNSVQpKSB8fCBERUZBVUxUX1dTX1NVQlNDUklQVElPTl9MSU1JVCxcbiAgc3Vic2NyaXB0aW9uVFRMOiBOdW1iZXIoZ2V0RW52KEVOVl9XU19TVUJTQ1JJUFRJT05fVFRMKSkgfHwgREVGQVVMVF9XU19TVUJTQ1JJUFRJT05fVFRMLFxuICBzdWJzY3JpcHRpb25VbnJlc3BvbnNpdmVUVEw6XG4gICAgTnVtYmVyKGdldEVudihFTlZfV1NfU1VCU0NSSVBUSU9OX1VOUkVTUE9OU0lWRV9UVEwpKSB8fFxuICAgIERFRkFVTFRfV1NfU1VCU0NSSVBUSU9OX1VOUkVTUE9OU0lWRV9UVEwsXG4gIHN1YnNjcmlwdGlvblByaW9yaXR5TGlzdDogKGdldEVudihFTlZfV1NfU1VCU0NSSVBUSU9OX1BSSU9SSVRZX0xJU1QpIHx8IFtdKSBhcyBBcnJheTxzdHJpbmc+LCAvLyBUT0RPOiBsb2FkIGFycmF5LFxuICBkZWZhdWx0SGVhcnRiZWF0SW50ZXJ2YWxJbk1TOiBOdW1iZXIoXG4gICAgZ2V0RW52KCdERUZBVUxUX1dTX0hFQVJUQkVBVF9JTlRFUlZBTCcpIHx8IERFRkFVTFRfV1NfSEVBUlRCRUFUX0lOVEVSVkFMLFxuICApLFxufSlcblxuZXhwb3J0IGNvbnN0IHdzUmVkYWN0UGF0aHMgPSBbXG4gICdwYXlsb2FkLndzSGFuZGxlci5jb25uZWN0aW9uLnByb3RvY29sLnF1ZXJ5LmFwaV9rZXknLFxuICAncGF5bG9hZC5jb25uZWN0aW9uSW5mby51cmwnLFxuICAncGF5bG9hZC53c0hhbmRsZXIuY29ubmVjdGlvbi51cmwnLFxuXVxuIl19